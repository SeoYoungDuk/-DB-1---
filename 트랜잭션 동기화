트랜잭션을 유지하려면 트랙잭션의 시작부터 끝까지 같은 커넥션을 유지해야함.

파라미터에 커넥션을 넘기는방법을 사용했음. -> 코드 지저분해지고, 코드중복있음

스프링 트랜잭션 동기화 매니저를 제공
스레드로컬을 이용해서 커넥션 동기화 해줌
커넥션 필요하면 트랜잭션 동기화 매니저를 통해 커넥션을 획득하면 됨.

동작방식
1. 트랜잭션매니저는 데이터소스를 통해 커넥션 만들고 트랜잭션 시작함.
2. 트랜잭션 매니저는 트랜잭션이 시작된 커넥션을 트랜잭션 동기화 매니저에 보관함.
3. 리포지토리는 트랜잭션 동기화 매니저에 보관된 커넥션을 꺼내서 사용.
4. 트랜잭션이 종료되면 트랜잭션 매니저는 트랜잭션 동기화 매니저에 보관된 커넥션을 통해 트랜잭션을 종료하고, 커넥션을 닫음.

쓰레드 로컬을 사용하면 각각의 쓰레드마다 별도의 저장소가 부여됨, 해당쓰레드만 해당 데이터에 접근 할 수 있다.

트랜잭션매니저  동기화 매니저(커넥션)

서비스        리포지토리(커넥션 꺼내서 씀)
